# API для видеохостинга

## Общая информация

`Swagger UI` документация: https://petstore.swagger.io/?url=https://raw.githubusercontent.com/youngliqui/videohosting-api/refs/heads/feature/documentation/docs/swagger-doc.yaml

Приложение представляет собой веб-сервис для работы с каналами видеохостинга. Он позволяет пользователям
регистрироваться,
входить в систему, управлять своими данными, получать информацию о существующих каналах, получать подробную информацию о
конкретном канале,
подписываться и отписываться от каналов.

Сервис предполагает наличие одной из двух ролей у пользователя: `USER` или `ADMIN`

## Основные сущности API:

### User

Сущность `User` представляет пользователя видеохостинга. Пользователь имеет id, никнейм, пароль, роль, имя, эл.почту, список
каналов (подписки).
Может иметь роль `USER` или `ADMIN`.

```json
{
  "id": 3,
  "nickname": "user_nickname",
  "password": "user_password",
  "role": "USER",
  "name": "pavel",
  "email": "user@mail.com",
  "subscriptions": [
    {
      "id": 1,
      "name": "Channel name",
      "description": "Chennel description",
      "author": {
        "id": 4,
        "nickname": "author",
        "role": "USER",
        "name": "Pavel Petrov",
        "email": "user@mail.com"
      },
      "subscribersCount": 20,
      "language": "Russian",
      "avatar": "string",
      "category": "Movies",
      "createdAt": "2024-10-01"
    }
  ]
}
```

- **id**: (integer, int64) Уникальный идентификатор пользователя.
    - Пример: `5`

- **nickname**: (string) Уникальный никнейм пользователя.
    - Пример: `user_nickname`

- **password**: (string) Пароль пользователя.
    - Пример: `user_password`

- **role**: (string) Роль пользователя. Enum: USER, ADMIN.
    - Пример: `user_password`

- **name**: (string) Полное имя пользователя.
    - Пример: `Pavel Petrov`

- **email**: (string, email) Эл. почта пользователя.
    - Пример: `user@mail.com`

- **subscriptions**: (array of strings) Список каналов, на которые подписан пользователь.

---

### Channel

Сущность `Channel` представляет канал видеохостинга. Пользователи могут получать список каналов с пагинацией и
фильтрацией,
создавать канал, изменять информацию, подписываться и отписываться от каналов.

```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Channel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "bytes...",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```

- **id**: (integer, int64) Уникальный идентификатор канала.
    - Пример: `1`

- **name**: (string) Название канала.
    - Пример: `Channel Name`
  
- **author**: (object) Пользователь, который создал канал.
  - Пример:
```json
{
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  }
```

- **description**: (string) Описание канала.
    - Пример: `Description of the channel`

- **subscribersCount**: (integer) Количество подписчиков канала.
    - Пример: `20`

- **language**: (string) Язык канала.
    - Пример: `Russian`

- **avatar**: (string, binary) Аватар канала.

- **category**: (string) Категория канала.
    - Пример: `Movies`

- **createdAt**: (string, date) Дата создания канала.
    - Пример: `2024-10-01`

---

## Связи между сущностями

1. **Пользователь и Канал**
    - Один пользователь может создавать только один канал.
    - Каждый канал принадлежит только одному пользователю.

2. **Подписка**
    - Пользователь может подписываться на множество каналов.
    - Канал может иметь множество подписчиков.

---

## Теги

- **security**: Операции с security.
- **users**: Операции с пользователями.
- **channels**: Операции с каналами.

---

## Эндпоинты

## Тег: Security

### 1. Регистрация нового пользователя

**URL:** `/register`  
**Метод:** `POST`

#### Запрос

**Тело запроса:**

```json
{
  "nickname": "user",
  "password": "user",
  "name": "Pavel Petrov",
  "email": "user@mail.com"
}
```

**Ответы:**

- **201**: Пользователь успешно зарегистрирован.
- **400**: Неверный запрос, отсутствуют обязательные поля.
- **404**: Неверные учетные данные.
- **409**: Пользователь с таким никнеймом или email уже существует.
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 2. Вход пользователя в систему и получение JWT токена

**URL:** `/login`
**Метод:** `POST`

#### Запрос

**Тело запроса:**

```json
{
  "nickname": "user",
  "password": "user"
}
```

**Ответы:**

- **201**: Успешный вход и возвращение JWT токена:
```json
    {
      "token": "string"
    } 
```
- **400**: Неверный запрос, отсутствуют обязательные поля.
- **401**: Неавторизованный доступ, неверные учетные данные
- **403**: Учетная запись пользователя заблокирована или неактивна
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

## Тег: Users

### 3. Получение всех пользователей с функциями пагинации и фильтрации (по username)

Доступ к данному запросу имеет только `ADMIN`.

Параметры: `username`, `page`, `size`.
Все параметры являются `необязательными`.

**URL:** `/users`
**Метод:** `GET`

**Ответы:**

- **200**: Список пользователей успешно получен:
    - ```json
      [
        {
          "id": 3,
          "nickname": "user nickname",
          "role": "USER",
          "name": "pavel",
          "email": "user@mail.com"
         }
       ]
      ```
- **400**: Неверный запрос, параметры некорректны
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователи отсутствуют
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 4. Получение информации о пользователе по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}`
**Метод:** `GET`

**Ответы:**

- **200**: Информация о пользователе успешно получена:
  - ```json
      {
        "id": 3,
        "nickname": "user nickname",
        "role": "USER",
        "name": "pavel",
        "email": "user@mail.com"
      }
      ```
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным никнеймом не существует 
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 5. Изменение информации о пользователе по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}`
**Метод:** `POST`

#### Запрос

**Тело запроса:**

```json
{
  "nickname": "new nickname",
  "password": "new password",
  "name": "new name",
  "email": "newuser@mail.com"
}
```

**Ответы:**

- **200**: Данные пользователя успешно обновлены
- **400**: Некорректно введенные данные
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным в параметрах никнеймом не найден
- **409**: Пользователь с новым никнеймом уже существует
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 6. Изменение имени пользователя по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}/nickname`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "nickname": "string"
}
```

**Ответы:**

- **200**: Имя пользователя успешно обновлено:
```json
{
  "id": 3,
  "nickname": "user nickname",
  "role": "USER",
  "name": "pavel",
  "email": "user@mail.com"
}
```
- **400**: Некорректно введенные данные
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным в параметрах никнеймом не существует
- **409**: Пользователь с новым никнеймом уже найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 7. Изменение ФИО пользователя по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}/name`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "name": "string"
}
```

**Ответы:**

- **200**: ФИО пользователя успешно обновлено:
```json
{
  "id": 3,
  "nickname": "user nickname",
  "role": "USER",
  "name": "pavel",
  "email": "user@mail.com"
}
```
- **400**: Некорректно введенные данные
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным в параметрах никнеймом не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 8. Изменение пароля пользователя по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}/password`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "currentPassword": "current",
  "newPassword": "new",
  "confirmPassword": "confirm"
}
```

**Ответы:**

- **200**: Пароль пользователя успешно обновлен:
```json
{
  "id": 3,
  "nickname": "user nickname",
  "role": "USER",
  "name": "pavel",
  "email": "user@mail.com"
}
```
- **400**: Некорректно введенные данные
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным в параметрах никнеймом не найден
- **409**: Новый пароль и подтверждение не совпадают
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 9. Изменение эл.почты пользователя по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username

Параметры: `username`

**URL:** `/users/{username}/email`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "email": "string"
}
```

**Ответы:**

- **200**: Эл.почта пользователя успешно обновлена:
```json
{
  "id": 3,
  "nickname": "user nickname",
  "role": "USER",
  "name": "pavel",
  "email": "user@mail.com"
}
```
- **400**: Некорректно введенные данные
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Пользователь с указанным в параметрах никнеймом не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 10. Получение списка подписок пользователя по username

Доступ к данному запросу имеет только `ADMIN` или пользователей с таким username.
Возвращает список названий каналов, на которые подписан пользователь.

Параметры: `username`

**URL:** `/users/{username}/subscriptions`
**Метод:** `GET`

**Ответы:**

- **200**: Список подписок получен успешно:
```json
[
  "channel_name1", "channel_name2"
]
```
- **401**: Неавторизованный доступ
- **403**: У пользователя недостаточно прав для выполнения этой операции
- **404**: Пользователь с указанным в параметрах никнеймом не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

## Тег: Channels
### 11. Получение всех каналов с функциями пагинации и фильтрации по `name`, `language`, `category`

Доступ к данному запросу имеют все.

Параметры: `name`, `language`, `category`, `page`, `size`.
Все параметры являются `необязательными`.

**URL:** `/channels`
**Метод:** `GET`

**Ответы:**

- **200**: Список каналов успешно получен:
```json
[
  {
    "name": "Channel name",
    "subscribersCount": 20,
    "language": "Russian",
    "avatar": "string",
    "category": "Movies"
  }
]
```
- **400**: Некорректно введенные параметры
- **404**: Каналы не найдены
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 12. Создание нового канала

Доступ к данному запросу имеют `USER` и `ADMIN`.

**URL:** `/channels`
**Метод:** `POST`

#### Запрос

**Тело запроса:**

```json
{
  "name": "Movies world",
  "language": "Russian",
  "avatar": "bytes...",
  "category": "Movies"
}
```

**Ответы:**

- **201**: Канал был успешно создан
- **400**: Неверный запрос. Отсутствуют обязательные поля
- **401**: Неавторизованный доступ
- **409**: Канал с таким именем уже существует или пользователь уже имеет канал
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 13. Получение подробной информации о канале по channelName

Доступ к данному запросу имеют все.

Параметры: `channelName`

**URL:** `/channels/{channelname}`
**Метод:** `GET`

**Ответы:**

- **200**: Информация о канале успешно получена:
```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Chennel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "bytes...",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```
- **404**: Канал с таким именем не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 14. Изменение информации о канале по channelName

Доступ к данному запросу имеют 'ADMIN' или автор канала.

Параметры: `channelName`

**URL:** `/channels/{channelname}`
**Метод:** `PUT`

#### Запрос

**Тело запроса:**

```json
{
  "name": "new channel name",
  "description": "new description",
  "language": "new language",
  "avatar": "bytes...",
  "category": "new category"
}
```

**Ответы:**

- **200**: Информация о канале успешно изменена:
```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Chennel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "bytes...",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```
- **400**: Данные для обновления некорректны
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Канал с таким именем не найден
- **409**: Новое название канала уже занято
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 15. Изменение описания канала
Доступ к данному запросу имеют 'ADMIN' или `автор` канала.

Параметры: `channelName`

**URL:** `/channels/{channelname}/description`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "description": "new description"
}
```

**Ответы:**

- **200**: Описание канала успешно изменено:
```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Chennel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "string",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```
- **400**: Данные для обновления некорректны
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Канал с таким именем не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 16. Изменение аватарки канала
Доступ к данному запросу имеют 'ADMIN' или `автор` канала.

Параметры: `channelName`

**URL:** `/channels/{channelname}/avatar`
**Метод:** `PATCH`

#### Запрос

**Multipart/form-data файл**

**Ответы:**

- **200**: Аватарка канала успешно изменена:
```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Chennel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "string",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```
- **400**: Данные для обновления некорректны
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Канал с таким именем не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 17. Изменение языка канала
Доступ к данному запросу имеют 'ADMIN' или `автор` канала.

Параметры: `channelName`

**URL:** `/channels/{channelname}/language`
**Метод:** `PATCH`

#### Запрос

**Тело запроса:**

```json
{
  "language": "new_language"
}
```

**Ответы:**

- **200**: Язык канала успешно изменен:
```json
{
  "id": 1,
  "name": "Channel name",
  "description": "Chennel description",
  "author": {
    "id": 3,
    "nickname": "user nickname",
    "role": "USER",
    "name": "pavel",
    "email": "user@mail.com"
  },
  "subscribersCount": 20,
  "language": "Russian",
  "avatar": "bytes...",
  "category": "Movies",
  "createdAt": "2024-10-01"
}
```
- **400**: Данные для обновления некорректны
- **401**: Неавторизованный доступ
- **403**: У пользователя нет прав доступа
- **404**: Канал с таким именем не найден
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 18. Подписка на канал
Доступ к данному запросу имеют 'ADMIN' и 'USER'. Но подписаться можно только один раз.

Параметры: `channelName`

**URL:** `/channels/{channelname}/subscribers`
**Метод:** `POST`

**Ответы:**

- **200**: Успешная подписка на канал
- **401**: Неавторизованный доступ
- **403**: Пользователь не может подписаться на этот канал
- **404**: Канал с таким названием не найден
- **409**: Пользователь уже подписан на этот канал
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос

### 19. Отписка от канала
Доступ к данному запросу имеют 'ADMIN' и 'USER'. Но отписаться можно только один раз.

Параметры: `channelName`

**URL:** `/channels/{channelname}/subscribers`
**Метод:** `DELETE`

**Ответы:**

- **200**: Успешная отписка от канала
- **401**: Неавторизованный доступ
- **403**: Пользователь не может отписаться от этого канала
- **404**: Канал с таким названием не найден
- **409**: Пользователь не подписан на этот канал
- **500**: Внутренняя ошибка сервера. Не удалось выполнить запрос
